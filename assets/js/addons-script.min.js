mailster=function(e,n,t,s){"use strict";var a=n(".wp-filter"),i=n(".theme-browser"),l=a.find(".filter-links a"),o=a.find(".search-form"),d=a.find(".wp-filter-search"),r=a.find("#typeselector"),c,u,f="",m="",g=1,h=0,p=0,v=d.val(),C=r.val(),w=[],y=false,b=false;l.on("click",function(e){e.preventDefault();if(!y)j(n(this).data("sort"));return});o.on("submit",function(e){e.preventDefault();c&&clearTimeout(c);q()});d.on("keyup change",function(e){if(13==e.keyCode){return}c&&clearTimeout(c);c=setTimeout(q,1e3)});r.on("change",function(e){c&&clearTimeout(c);q()});i.on("click",".theme-screenshot, .more-details",function(){k.open(n(this).closest(".theme"))}).on("click",".update",function(e){e.preventDefault();n(this).addClass("updating-message");S(this.href,n(this).closest(".theme").data("slug"))}).on("click",".download",function(e){e.preventDefault();n(this).addClass("updating-message");R(this.href,n(this).closest(".theme").data("slug"))}).on("click",".install",function(e){e.preventDefault();n(this).addClass("updating-message");$(n(this).closest(".theme").data("slug"))}).on("click",".activate",function(e){e.preventDefault();n(this).addClass("updating-message");U(n(this).closest(".theme").data("slug"))}).on("click",".deactivate",function(e){e.preventDefault();n(this).addClass("updating-message");L(n(this).closest(".theme").data("slug"))}).on("click",".popup",function(){var s=this.href;if(!/^https?/.test(s))return true;var a=n(this).data(),i=t.screenLeft!=undefined?t.screenLeft:screen.left,l=t.screenTop!=undefined?t.screenTop:screen.top,o=e.$.window.width(),d=e.$.window.height(),r,c,u;if(/%/.test(a.width)){a.width=o*(parseInt(a.width,10)/100)}if(/%/.test(a.height)){a.height=d*(parseInt(a.height,10)/100)}r=o/2-a.width/2+i;c=d/2-a.height/2+l;u=t.open(s,"mailster_themebrowser","scrollbars=auto,resizable=1,menubar=0,toolbar=0,location=0,directories=0,status=0, width="+a.width+", height="+a.height+", top="+c+", left="+r);if(t.focus)u.focus();return false});n(".upload-addon").on("click",function(){n(".upload-field").toggle()});e.$.window.on("click",".upload-addon",function(){n(".upload-field").show()});e.events.push("documentReady",function(){e.$.window.on("scroll.mailster",e.util.throttle(_,500))});var k=function(){if(this===t)return new a;var a=n(".theme-overlay"),i=null,l=null,o=null,d=null,r=a.find(".right"),c=a.find(".left"),u=a.find(".close"),f=a.find(".default"),m=a.find(".campaign"),g=a.find(".delete-theme"),h={};var p=function(t){if("string"===typeof t){t=n('[data-slug="'+t+'"]')}if(!t||!t.length)return false;a.find(".theme-screenshots img").hide();a.find(".theme-screenshots iframe").hide();a.removeAttr("class");a.addClass("theme-overlay loading");i=t;h=t.data("item");a.find(".theme-name").html(h.name+'<span class="theme-version">'+(h.version?h.version:"")+"</span>");a.find(".theme-author").html(e.util.sprintf("By "+h.author));a.find(".theme-description").html(h.description);a.find(".theme-tags").html(h.tags&&h.tags.length?"<span>Tags:</span> "+h.tags.join(", "):"");if(h.src){a.find(".theme-screenshots iframe").show().attr("src",h.src+"?nocache="+ +new Date)}else{a.find(".theme-screenshots img").attr("src",h.image_full).attr("srcset",h.image_full+" 1x, "+h.image_fullx2+" 2x")}if(h.update_available)a.addClass("has-update");if(h.installed)a.addClass("is-installed");if(h.is_default)a.addClass("is-default");if(h.download)a.addClass("has-download");if(h.purchase_url)a.addClass("has-purchase");var s="";if(h.files){s+='<label>Template Files: <select class="theme-file-selector">';for(var d in h.files){if(h.files.hasOwnProperty(d))s+='<option value="'+d+'">'+h.files[d].label+" ("+d+")</option>"}s+="</select></label>"}a.find(".theme-files").html(s);l=i.prev();o=i.next();c.prop("disabled",!l.length)[!l.length?"addClass":"removeClass"]("disabled");r.prop("disabled",!o.length)[!o.length?"addClass":"removeClass"]("disabled");a.show();A("addon",h.slug);a.removeClass("loading")},v=function(){B("addon");a.hide()},C=function(){p(i.next())},w=function(){p(i.prev())},b=function(){var t=n(".theme-file-selector").val();if("index.html"==t&&confirm(e.util.sprintf(e.l10n.addons.confirm_delete,'"'+h.name+'"'))){I(h.slug);v()}else if(confirm(e.util.sprintf(e.l10n.addons.confirm_delete_file,'"'+t+'"','"'+h.name+'"'))){I(h.slug,t,function(){n(".theme-file-selector").val("index.html").trigger("change").find('option[value="'+t+'"]').remove()})}return false},k=function(){if(confirm(e.util.sprintf(e.l10n.addons.confirm_default,'"'+h.name+'"'))){var t=n('[data-slug="'+h.slug+'"]');y=true;e.util.ajax("default_addon",{slug:h.slug},function(e){if(e.success){j("installed",function(){n('[data-slug="'+h.slug+'"]').find(".notice-success").html("<p>"+e.msg+"</p>")});t.find(".notice-error").empty()}else{t.find(".notice-error").html("<p>"+e.msg+"</p>")}t.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false;v()},function(e,n,t){})}return false},x=function(){s.location=this.href+"&addon="+h.slug+"&file="+a.find(".theme-file-selector").val();return false},_=function(){a.find(".theme-screenshots iframe").attr("src",h.files[n(this).val()].src)},D=function(){r.on("click",C);c.on("click",w);u.on("click",v);g.on("click",b);f.on("click",k);m.on("click",x);a.on("change",".theme-file-selector",_);a.find(".theme-screenshots iframe").on("load",function(){a.removeClass("loading")});a.find(".theme-screenshots img").on("load",function(){n(this).show()})};D();return{open:p,close:v,next:C,prev:w,delete:b}}();function x(){d.val(z("search"));r.val(z("type")||"term");u=z("browse")||"all";if(z("search")){q()}else{j(u);k.open(z("addon"))}}function _(){var n=e.util.top()+e.$.window.height();if(!y&&n>Math.round(s.documentElement.scrollHeight*.9)&&h>p){g++;F()}}function j(e,t){u&&n("body").removeClass("browse-"+u)&&l.filter('[data-sort="'+u+'"]').removeClass("current");u=e||false;B("addon");if(u){T();l.filter('[data-sort="'+u+'"]').addClass("current");A("browse",u);n("body").addClass("browse-"+u);F(t)}}function D(){u&&n("body").removeClass("browse-"+u)&&l.filter('[data-sort="'+u+'"]').removeClass("current");B("browse");B("addon");u=false;g=1;w=[]}function T(){B("search");B("type");m="";f="";d.val("");r.val("term");g=1;w=[]}function q(){v=e.util.trim(d.val());v=v.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");C=r.val();if(v&&(f!=v||m!=C)){m=C;f=v;D();F();A("search",v);A("type",C)}return}function $(t){var s=n('[data-slug="'+t+'"]');y=true;s.addClass("loading");s.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.addons.installing+"</p>");e.util.ajax("quick_install",{plugin:t,step:"install"},function(n){if(n.success){s.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.installed+"</p>");s.find(".notice-error").empty()}else{s.find(".notice-error").html("<p>"+n.msg+"</p>")}s.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,n,t){})}function R(t,s){var a=n('[data-slug="'+s+'"]');console.log(a);y=true;a.addClass("loading").find(".request-download").addClass("updating-message");a.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.addons.installing+"</p>");return;e.util.ajax("quick_install",{url:t,slug:s},function(n){if(n.success){a.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.installed+"</p>");a.find(".notice-error").empty()}else{a.find(".notice-error").html("<p>"+n.msg+"</p>")}a.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,n,t){})}function U(t){var s=n('[data-slug="'+t+'"]');y=true;s.addClass("loading");s.find(".notice-warning").addClass("updating-message").html("<p>1"+e.l10n.addons.activating+"</p>");e.util.ajax("quick_install",{plugin:t,step:"activate"},function(n){if(n.success){s.addClass("active").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.activated+"</p>");s.find(".notice-error").empty()}else{s.find(".notice-error").html("<p>"+n.msg+"</p>")}s.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,n,t){})}function L(t){var s=n('[data-slug="'+t+'"]');y=true;s.addClass("loading");s.find(".notice-warning").addClass("updating-message").html("<p>2"+e.l10n.addons.deactivating+"</p>");e.util.ajax("quick_install",{plugin:t,step:"deactivate"},function(n){if(n.success){s.removeClass("active").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.deactivated+"</p>");s.find(".notice-error").empty()}else{s.find(".notice-error").html("<p>"+n.msg+"</p>")}s.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,n,t){})}function S(t,s){var a=n('[data-slug="'+s+'"]');y=true;a.addClass("loading").find(".request-download").addClass("updating-message");a.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.addons.updating+"</p>");e.util.ajax("download_addon",{url:t,slug:s},function(t){if(t.success){a.find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.addons.updated+"</p>");a.find(".notice-error").empty();var s=n("#menu-posts-newsletter").find(".current").find(".update-plugins");if(s){if(s.text()>1){s.find(".update-count").text(s.text()-1)}else{s.remove()}}}else{a.find(".notice-error").html("<p>"+t.msg+"</p>")}a.removeClass("loading").find(".updating-message").removeClass("updating-message");y=false},function(e,n,t){})}function I(t,s,a){var i=n('[data-slug="'+t+'"]');y=true;i.addClass("loading");e.util.ajax("delete_addon",{slug:t,file:s||null},function(e){if(a){i.removeClass("loading");a()}else{i.animate({opacity:0},function(){i.animate({width:0,"margin-right":0},function(){i.remove();y=false})})}},function(e,n,t){})}function P(e,t){var s=n('[data-slug="'+e+'"]');s.find(".notice-error").html("<p>"+n("<div>"+t+"</div>").text()+"</p>")}function F(t){if(g==1){n("body").removeClass("no-results");n("body").addClass("loading-content");i.html("");w=[]}y=true;e.util.ajax("query_addons",{search:d.val(),type:r.val(),browse:z("browse"),page:g},function(e){if(g==1){n("body").removeClass("loading-content");n(".theme-count").html(e.total);h=e.total}w.concat(e.addons);i.append(e.html);p=n(".theme").length;if(e.error){alert(e.error);n("body").addClass("no-results")}else if(!p){n("body").addClass("no-results")}y=false;t&&t()},function(e,n,t){})}function z(e){var n=new URLSearchParams(t.location.search);return n.get(e)}function A(e,n){var s=new URLSearchParams(t.location.search);s.set(e,n);t.history.pushState({},"",decodeURIComponent(t.location.pathname+"?"+s))}function B(e){var n=new URLSearchParams(t.location.search);n.delete(e);t.history.pushState({},"",decodeURIComponent(t.location.pathname+"?"+n))}x();e.addons=e.addons||{};e.addons.install=$;e.addons.installFromUrl=R;e.addons.delete=I;e.addons.error=P;return e}(mailster||{},jQuery,window,document);