mailster=function(e,t,n,a){"use strict";var i=t(".wp-filter"),s=t(".theme-browser"),l=i.find(".filter-links a"),o=i.find(".search-form"),r=i.find(".wp-filter-search"),d=i.find("#typeselector"),f,c,u="",m="",p=1,h=0,g=0,v=r.val(),w=d.val(),C=[],b=false,y=false;l.on("click",function(e){e.preventDefault();if(!b)U(t(this).data("sort"));return});o.on("submit",function(e){e.preventDefault();f&&clearTimeout(f);D()});r.on("keyup change",function(e){if(13==e.keyCode){return}f&&clearTimeout(f);f=setTimeout(D,1e3)});d.on("change",function(e){f&&clearTimeout(f);D()});s.on("click",".theme-screenshot, .more-details",function(){x.open(t(this).closest(".theme"))}).on("click",".update",function(e){e.preventDefault();t(this).addClass("updating-message");R(this.href,t(this).closest(".theme").data("slug"))}).on("click",".download",function(e){e.preventDefault();t(this).addClass("updating-message");I(this.href,t(this).closest(".theme").data("slug"))}).on("click",".popup",function(){var a=this.href;if(!/^https?/.test(a))return true;var i=t(this).data(),s=n.screenLeft!=undefined?n.screenLeft:screen.left,l=n.screenTop!=undefined?n.screenTop:screen.top,o=e.$.window.width(),r=e.$.window.height(),d,f,c;if(/%/.test(i.width)){i.width=o*(parseInt(i.width,10)/100)}if(/%/.test(i.height)){i.height=r*(parseInt(i.height,10)/100)}d=o/2-i.width/2+s;f=r/2-i.height/2+l;c=n.open(a,"mailster_themebrowser","scrollbars=auto,resizable=1,menubar=0,toolbar=0,location=0,directories=0,status=0, width="+i.width+", height="+i.height+", top="+f+", left="+d);if(n.focus)c.focus();return false});t(".upload-template").on("click",function(){t(".upload-field").toggle()});e.$.window.on("click",".upload-template",function(){t(".upload-field").show()});e.events.push("documentReady",function(){q();e.$.window.on("scroll.mailster",e.util.throttle(k,500))});var x=function(){if(this===n)return new i;var i=t(".theme-overlay"),s=null,l=null,o=null,r=null,d=i.find(".right"),f=i.find(".left"),c=i.find(".close"),u=i.find(".default"),m=i.find(".campaign"),p=i.find(".edit"),h=i.find(".save"),g=i.find(".delete-theme"),v,w=i.find(".codeeditor textarea"),C={};var y=function(n){if("string"===typeof n){n=t('[data-slug="'+n+'"]')}if(!n||!n.length)return false;i.addClass("loading");i.find(".theme-screenshots img").hide();i.find(".theme-screenshots iframe").hide();i.removeAttr("class");i.addClass("theme-overlay loading");s=n;C=n.data("item");i.find(".theme-name").html(C.name+'<span class="theme-version">'+(C.version?C.version:"")+"</span>");i.find(".theme-author").html(e.util.sprintf("By "+C.author));i.find(".theme-description").html(C.description);i.find(".theme-tags").html(C.tags&&C.tags.length?"<span>Tags:</span> "+C.tags.join(", "):"");if(C.src){i.find(".theme-screenshots iframe").show().attr("src",C.src+"?nocache="+ +new Date)}else{i.find(".theme-screenshots img").attr("src",C.image_full).attr("srcset",C.image_full+" 1x, "+C.image_fullx2+" 2x")}if(C.update_available)i.addClass("has-update");if(C.installed)i.addClass("is-installed");if(C.is_default)i.addClass("is-default");if(C.download)i.addClass("has-download");if(C.purchase_url)i.addClass("has-purchase");var a="";if(C.files){a+='<label>Template Files: <select class="theme-file-selector">';for(var r in C.files){if(C.files.hasOwnProperty(r))a+='<option value="'+r+'">'+C.files[r].label+" ("+r+")</option>"}a+="</select></label>"}i.find(".theme-files").html(a);l=s.prev();o=s.next();f.prop("disabled",!l.length)[!l.length?"addClass":"removeClass"]("disabled");d.prop("disabled",!o.length)[!o.length?"addClass":"removeClass"]("disabled");i.show();E("template",C.slug)},x=function(){M("template");i.hide()},_=function(){y(s.next())},k=function(){y(s.prev())},T=function(){var n=t(".theme-file-selector").val();if("index.html"==n&&confirm(e.util.sprintf(e.l10n.templates.confirm_delete,'"'+C.name+'"'))){S(C.slug);x()}else if(confirm(e.util.sprintf(e.l10n.templates.confirm_delete_file,'"'+n+'"','"'+C.name+'"'))){S(C.slug,n,function(){t(".theme-file-selector").val("index.html").trigger("change").find('option[value="'+n+'"]').remove()})}return false},j=function(){if(confirm(e.util.sprintf(e.l10n.templates.confirm_default,'"'+C.name+'"'))){var n=t('[data-slug="'+C.slug+'"]');b=true;e.util.ajax("default_template",{slug:C.slug},function(e){if(e.success){U("installed",function(){t('[data-slug="'+C.slug+'"]').find(".notice-success").html("<p>"+e.msg+"</p>")});n.find(".notice-error").empty()}else{n.find(".notice-error").html("<p>"+e.msg+"</p>")}n.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false;x()},function(e,t,n){})}return false},D=function(){a.location=this.href+"&template="+C.slug+"&file="+i.find(".theme-file-selector").val();return false},$=function(){e.util.ajax("load_template_file",{template:C.slug,file:i.find(".theme-file-selector").val()},function(a){i.addClass("is-editor");i.find(".codeeditor h3").html(e.util.sprintf(e.l10n.templates.editing,i.find(".theme-file-selector").val(),'"'+C.name+'"'));t(".CodeMirror").remove();w.val(a.html);if(wp.codeEditor){v=wp.codeEditor.initialize(w,{codemirror:e.util.codemirrorargs})}else{v={codemirror:n.CodeMirror.fromTextArea(w.get(0),e.util.codemirrorargs)}}},function(e,t,n){});return false},I=function(){e.util.ajax("set_template_html",{content:v.codemirror.getValue(),slug:C.slug,file:i.find(".theme-file-selector").val()},function(e){i.removeClass("is-editor");t(".CodeMirror").remove();w.val("");i.find(".theme-screenshots iframe").attr("src",i.find(".theme-screenshots iframe").attr("src"))},function(e,t,n){});return false},R=function(){i.addClass("loading");i.find(".theme-screenshots iframe").attr("src",C.files[t(this).val()].src);if(i.is(".is-editor")){$()}},F=function(){d.on("click",_);f.on("click",k);c.on("click",x);g.on("click",T);u.on("click",j);m.on("click",D);p.on("click",$);h.on("click",I);i.on("change",".theme-file-selector",R);i.on("click",".theme-description a",function(e){e.preventDefault();n.open(this.href);return false});i.find(".theme-screenshots iframe").on("load",function(){i.removeClass("loading")});i.find(".theme-screenshots img").on("load",function(){t(this).show()})};F();return{open:y,close:x,next:_,prev:k,delete:T}}();function _(){r.val(P("search"));d.val(P("type")||"term");c=P("browse")||"installed";if(P("search")){D()}else{U(c);x.open(P("template"))}}function k(){var t=e.util.top()+e.$.window.height();if(!b&&t>Math.round(a.documentElement.scrollHeight*.9)&&h>g){p++;L()}}function U(e,n){c&&t("body").removeClass("browse-"+c)&&l.filter('[data-sort="'+c+'"]').removeClass("current");c=e||false;M("template");if(c){j();l.filter('[data-sort="'+c+'"]').addClass("current");E("browse",c);t("body").addClass("browse-"+c);L(n)}}function T(){c&&t("body").removeClass("browse-"+c)&&l.filter('[data-sort="'+c+'"]').removeClass("current");M("browse");M("template");c=false;p=1;C=[]}function j(){M("search");M("type");m="";u="";r.val("");d.val("term");p=1;C=[]}function D(){v=e.util.trim(r.val());v=v.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");w=d.val();if(v&&(u!=v||m!=w)){m=w;u=v;T();L();E("search",v);E("type",w)}return}function $(n){var a=t('[data-slug="'+n+'"]');b=true;a.addClass("loading");a.find(".notice-warning").addClass("updating-message").html("<p>Updating...</p>");e.util.ajax("download_template",{slug:n},function(e){b=false},function(e,t,n){})}function I(n,a){var i=t('[data-slug="'+a+'"]');b=true;i.addClass("loading").find(".request-download").addClass("updating-message");i.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.templates.downloading+"</p>");e.util.ajax("download_template",{url:n,slug:a},function(t){if(t.success){i.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.templates.downloaded+"</p>");i.find(".notice-error").empty()}else{i.find(".notice-error").html("<p>"+t.msg+"</p>")}i.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false},function(e,t,n){})}function R(n,a){var i=t('[data-slug="'+a+'"]');b=true;i.addClass("loading").find(".request-download").addClass("updating-message");i.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.templates.updating+"</p>");e.util.ajax("download_template",{url:n,slug:a},function(n){if(n.success){i.find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.templates.updated+"</p>");i.find(".notice-error").empty();var a=t("#menu-posts-newsletter").find(".current").find(".update-plugins");if(a){if(a.text()>1){a.find(".update-count").text(a.text()-1)}else{a.remove()}}}else{i.find(".notice-error").html("<p>"+n.msg+"</p>")}i.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false},function(e,t,n){})}function S(n,a,i){var s=t('[data-slug="'+n+'"]');b=true;s.addClass("loading");e.util.ajax("delete_template",{slug:n,file:a||null},function(e){if(i){s.removeClass("loading");i()}else{s.animate({opacity:0},function(){s.animate({width:0,"margin-right":0},function(){s.remove();b=false})})}},function(e,t,n){})}function F(e,n){var a=t('[data-slug="'+e+'"]');a.find(".notice-error").html("<p>"+t("<div>"+n+"</div>").text()+"</p>")}function L(n){if(p==1){t("body").removeClass("no-results");t("body").addClass("loading-content");s.html("");C=[]}b=true;e.util.ajax("query_templates",{search:r.val(),type:d.val(),browse:P("browse"),page:p},function(e){if(p==1){t("body").removeClass("loading-content");t(".theme-count").html(e.total);h=e.total}C.concat(e.templates);s.append(e.html);g=t(".theme").length;if(e.error){alert(e.error);t("body").addClass("no-results")}else if(!g){t("body").addClass("no-results")}b=false;n&&n()},function(e,t,n){})}function P(e){var t=new URLSearchParams(n.location.search);return t.get(e)}function E(e,t){var a=new URLSearchParams(n.location.search);a.set(e,t);n.history.pushState({},"",decodeURIComponent(n.location.pathname+"?"+a))}function M(e){var t=new URLSearchParams(n.location.search);t.delete(e);n.history.pushState({},"",decodeURIComponent(n.location.pathname+"?"+t))}function q(){var n=new plupload.Uploader(wpUploaderInit),a=t(".uploadinfo");n.bind("Init",function(n){var a=t("#plupload-upload-ui");if(n.features.dragdrop&&!e.util.isTouchDevice){a.addClass("drag-drop");t("#drag-drop-area").bind("dragover.wp-uploader",function(){a.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){a.removeClass("drag-over")})}else{a.removeClass("drag-drop");t("#drag-drop-area").unbind(".wp-uploader")}if(n.runtime=="html4")t(".upload-flash-bypass").hide()});n.init();n.bind("FilesAdded",function(e,t){setTimeout(function(){e.refresh();e.start()},1)});n.bind("BeforeUpload",function(e,t){});n.bind("UploadFile",function(e,t){});n.bind("UploadProgress",function(t,n){a.html(e.util.sprintf(e.l10n.templates.uploading,n.percent+"%"))});n.bind("Error",function(e,t){a.html(t.message);e.refresh()});n.bind("FileUploaded",function(e,t,n){n=JSON.parse(n.response);if(n.success){location.reload()}else{a.html(n.error)}});n.bind("UploadComplete",function(e,t){})}_();e.templates=e.templates||{};e.templates.download=$;e.templates.downloadFromUrl=I;e.templates.delete=S;e.templates.error=F;return e}(mailster||{},jQuery,window,document);