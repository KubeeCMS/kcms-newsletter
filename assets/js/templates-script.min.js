mailster=function(e,t,n,a){"use strict";var s=t(".wp-filter"),i=t(".theme-browser"),l=s.find(".filter-links a"),o=s.find(".search-form"),r=s.find(".wp-filter-search"),d=s.find("#typeselector"),u,f,c="",m="",p=1,h=0,g=0,v=r.val(),w=d.val(),C=[],b=false,y=false;l.on("click",function(e){e.preventDefault();if(!b)U(t(this).data("sort"));return});o.on("submit",function(e){e.preventDefault();u&&clearTimeout(u);$()});r.on("keyup change",function(e){if(13==e.keyCode){return}u&&clearTimeout(u);u=setTimeout($,1e3)});d.on("change",function(e){u&&clearTimeout(u);$()});i.on("click",".theme-screenshot, .more-details",function(){x.open(t(this).closest(".theme"))}).on("click",".update",function(e){e.preventDefault();t(this).addClass("updating-message");R(this.href,t(this).closest(".theme").data("slug"))}).on("click",".download",function(e){e.preventDefault();t(this).addClass("updating-message");I(this.href,t(this).closest(".theme").data("slug"))}).on("click",".popup",function(){var a=this.href;if(!/^https?/.test(a))return true;var s=t(this).data(),i=n.screenLeft!=undefined?n.screenLeft:screen.left,l=n.screenTop!=undefined?n.screenTop:screen.top,o=e.$.window.width(),r=e.$.window.height(),d,u,f;if(/%/.test(s.width)){s.width=o*(parseInt(s.width,10)/100)}if(/%/.test(s.height)){s.height=r*(parseInt(s.height,10)/100)}d=o/2-s.width/2+i;u=r/2-s.height/2+l;f=n.open(a,"mailster_themebrowser","scrollbars=auto,resizable=1,menubar=0,toolbar=0,location=0,directories=0,status=0, width="+s.width+", height="+s.height+", top="+u+", left="+d);if(n.focus)f.focus();return false});t(".upload-template").on("click",function(){t(".upload-field").toggle()});e.$.window.on("click",".upload-template",function(){t(".upload-field").show()});e.events.push("documentReady",function(){B();e.$.window.on("scroll.mailster",e.util.throttle(k,500))});var x=function(){if(this===n)return new s;var s=t(".theme-overlay"),i=null,l=null,o=null,r=null,d=s.find(".right"),u=s.find(".left"),f=s.find(".close"),c=s.find(".default"),m=s.find(".campaign"),p=s.find(".delete-theme"),h={};var g=function(n){if("string"===typeof n){n=t('[data-slug="'+n+'"]')}if(!n||!n.length)return false;s.find(".theme-screenshots img").hide();s.find(".theme-screenshots iframe").hide();s.removeAttr("class");s.addClass("theme-overlay loading");i=n;h=n.data("item");s.find(".theme-name").html(h.name+'<span class="theme-version">'+(h.version?h.version:"")+"</span>");s.find(".theme-author").html(e.util.sprintf("By "+h.author));s.find(".theme-description").html(h.description);s.find(".theme-tags").html(h.tags&&h.tags.length?"<span>Tags:</span> "+h.tags.join(", "):"");if(h.src){s.find(".theme-screenshots iframe").show().attr("src",h.src+"?nocache="+ +new Date)}else{s.find(".theme-screenshots img").attr("src",h.image_full).attr("srcset",h.image_full+" 1x, "+h.image_fullx2+" 2x")}if(h.update_available)s.addClass("has-update");if(h.installed)s.addClass("is-installed");if(h.is_default)s.addClass("is-default");if(h.download)s.addClass("has-download");if(h.purchase_url)s.addClass("has-purchase");var a="";if(h.files){a+='<label>Template Files: <select class="theme-file-selector">';for(var r in h.files){if(h.files.hasOwnProperty(r))a+='<option value="'+r+'">'+h.files[r].label+" ("+r+")</option>"}a+="</select></label>"}s.find(".theme-files").html(a);l=i.prev();o=i.next();u.prop("disabled",!l.length)[!l.length?"addClass":"removeClass"]("disabled");d.prop("disabled",!o.length)[!o.length?"addClass":"removeClass"]("disabled");s.show();q("template",h.slug);s.removeClass("loading")},v=function(){A("template");s.hide()},w=function(){g(i.next())},C=function(){g(i.prev())},y=function(){var n=t(".theme-file-selector").val();if("index.html"==n&&confirm(e.util.sprintf(e.l10n.templates.confirm_delete,'"'+h.name+'"'))){S(h.slug);v()}else if(confirm(e.util.sprintf(e.l10n.templates.confirm_delete_file,'"'+n+'"','"'+h.name+'"'))){S(h.slug,n,function(){t(".theme-file-selector").val("index.html").trigger("change").find('option[value="'+n+'"]').remove()})}return false},x=function(){if(confirm(e.util.sprintf(e.l10n.templates.confirm_default,'"'+h.name+'"'))){var n=t('[data-slug="'+h.slug+'"]');b=true;e.util.ajax("default_template",{slug:h.slug},function(e){if(e.success){U("installed",function(){t('[data-slug="'+h.slug+'"]').find(".notice-success").html("<p>"+e.msg+"</p>")});n.find(".notice-error").empty()}else{n.find(".notice-error").html("<p>"+e.msg+"</p>")}n.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false;v()},function(e,t,n){})}return false},_=function(){a.location=this.href+"&template="+h.slug+"&file="+s.find(".theme-file-selector").val();return false},k=function(){s.find(".theme-screenshots iframe").attr("src",h.files[t(this).val()].src)},T=function(){d.on("click",w);u.on("click",C);f.on("click",v);p.on("click",y);c.on("click",x);m.on("click",_);s.on("change",".theme-file-selector",k);s.find(".theme-screenshots iframe").on("load",function(){s.removeClass("loading")});s.find(".theme-screenshots img").on("load",function(){t(this).show()})};T();return{open:g,close:v,next:w,prev:C,delete:y}}();function _(){r.val(P("search"));d.val(P("type")||"term");f=P("browse")||"installed";if(P("search")){$()}else{U(f);x.open(P("template"))}}function k(){var t=e.util.top()+e.$.window.height();if(!b&&t>Math.round(a.documentElement.scrollHeight*.9)&&h>g){p++;L()}}function U(e,n){f&&t("body").removeClass("browse-"+f)&&l.filter('[data-sort="'+f+'"]').removeClass("current");f=e||false;A("template");if(f){j();l.filter('[data-sort="'+f+'"]').addClass("current");q("browse",f);t("body").addClass("browse-"+f);L(n)}}function T(){f&&t("body").removeClass("browse-"+f)&&l.filter('[data-sort="'+f+'"]').removeClass("current");A("browse");A("template");f=false;p=1;C=[]}function j(){A("search");A("type");m="";c="";r.val("");d.val("term");p=1;C=[]}function $(){v=e.util.trim(r.val());v=v.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");w=d.val();if(v&&(c!=v||m!=w)){m=w;c=v;T();L();q("search",v);q("type",w)}return}function D(n){var a=t('[data-slug="'+n+'"]');b=true;a.addClass("loading");a.find(".notice-warning").addClass("updating-message").html("<p>Updating...</p>");e.util.ajax("download_template",{slug:n},function(e){b=false},function(e,t,n){})}function I(n,a){var s=t('[data-slug="'+a+'"]');b=true;s.addClass("loading").find(".request-download").addClass("updating-message");s.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.templates.downloading+"</p>");e.util.ajax("download_template",{url:n,slug:a},function(t){if(t.success){s.addClass("is-installed").find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.templates.downloaded+"</p>");s.find(".notice-error").empty()}else{s.find(".notice-error").html("<p>"+t.msg+"</p>")}s.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false},function(e,t,n){})}function R(n,a){var s=t('[data-slug="'+a+'"]');b=true;s.addClass("loading").find(".request-download").addClass("updating-message");s.find(".notice-warning").addClass("updating-message").html("<p>"+e.l10n.templates.updating+"</p>");e.util.ajax("download_template",{url:n,slug:a},function(n){if(n.success){s.find(".notice-warning").removeClass("updating-message notice-warning").addClass("notice-success").html("<p>"+e.l10n.templates.updated+"</p>");s.find(".notice-error").empty();var a=t("#menu-posts-newsletter").find(".current").find(".update-plugins");if(a){if(a.text()>1){a.find(".update-count").text(a.text()-1)}else{a.remove()}}}else{s.find(".notice-error").html("<p>"+n.msg+"</p>")}s.removeClass("loading").find(".updating-message").removeClass("updating-message");b=false},function(e,t,n){})}function S(n,a,s){var i=t('[data-slug="'+n+'"]');b=true;i.addClass("loading");e.util.ajax("delete_template",{slug:n,file:a||null},function(e){if(s){i.removeClass("loading");s()}else{i.animate({opacity:0},function(){i.animate({width:0,"margin-right":0},function(){i.remove();b=false})})}},function(e,t,n){})}function F(e,n){var a=t('[data-slug="'+e+'"]');a.find(".notice-error").html("<p>"+t("<div>"+n+"</div>").text()+"</p>")}function L(n){if(p==1){t("body").removeClass("no-results");t("body").addClass("loading-content");i.html("");C=[]}b=true;e.util.ajax("query_templates",{search:r.val(),type:d.val(),browse:P("browse"),page:p},function(e){if(p==1){t("body").removeClass("loading-content");t(".theme-count").html(e.total);h=e.total}C.concat(e.templates);i.append(e.html);g=t(".theme").length;if(e.error){alert(e.error);t("body").addClass("no-results")}else if(!g){t("body").addClass("no-results")}b=false;n&&n()},function(e,t,n){})}function P(e){var t=new URLSearchParams(n.location.search);return t.get(e)}function q(e,t){var a=new URLSearchParams(n.location.search);a.set(e,t);n.history.pushState({},"",decodeURIComponent(n.location.pathname+"?"+a))}function A(e){var t=new URLSearchParams(n.location.search);t.delete(e);n.history.pushState({},"",decodeURIComponent(n.location.pathname+"?"+t))}function B(){var n=new plupload.Uploader(wpUploaderInit),a=t(".uploadinfo");n.bind("Init",function(n){var a=t("#plupload-upload-ui");if(n.features.dragdrop&&!e.util.isTouchDevice){a.addClass("drag-drop");t("#drag-drop-area").bind("dragover.wp-uploader",function(){a.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){a.removeClass("drag-over")})}else{a.removeClass("drag-drop");t("#drag-drop-area").unbind(".wp-uploader")}if(n.runtime=="html4")t(".upload-flash-bypass").hide()});n.init();n.bind("FilesAdded",function(e,t){setTimeout(function(){e.refresh();e.start()},1)});n.bind("BeforeUpload",function(e,t){});n.bind("UploadFile",function(e,t){});n.bind("UploadProgress",function(t,n){a.html(e.util.sprintf(e.l10n.templates.uploading,n.percent+"%"))});n.bind("Error",function(e,t){a.html(t.message);e.refresh()});n.bind("FileUploaded",function(e,t,n){n=JSON.parse(n.response);if(n.success){location.reload()}else{a.html(n.error)}});n.bind("UploadComplete",function(e,t){})}_();e.templates=e.templates||{};e.templates.download=D;e.templates.downloadFromUrl=I;e.templates.delete=S;e.templates.error=F;return e}(mailster||{},jQuery,window,document);