mailster=function(e,t,r,s){"use strict";var i={},c,a=t(".mailster-precheck"),n=t(".precheck-status"),l=t(".precheck-score"),o=t("#precheck-ajax-loading"),h=t("#precheck-authentication"),d=t(".precheck-run-btn"),u=t(".precheck-toggle-structure"),p=t(".precheck-toggle-images"),f=t(".mailster-preview-iframe"),m,g,k,v=0,b=true,_=false;e.precheck=e.precheck||{};a.on("click",".precheck-switch",y).on("click",".precheck-run-btn",j).on("click",".precheck-toggle-images",D).on("click",".precheck-toggle-structure",L).on("mouseenter",".assets-table tr",M).on("mouseleave",".assets-table tr",M).on("click",".change-receiver",I).on("click","#precheck-agree",Q);t(".precheck-subscriber").on("focus",function(){t(this).select()}).autocomplete({source:function(t,r){e.util.ajax("search_subscribers",{id:e.campaign_id,term:t.term},function(e){r(e)},function(e,t,r){})},appendTo:".precheck-emailheader",minLength:3,select:function(e,r){t("#subscriber_id").val(r.item.id);B()},change:function(e,r){if(!r.item){t("#subscriber_id").val(0);B()}}});function w(t,r){var s=e.l10n.precheck[t]||t;l.removeAttr("class").addClass("precheck-score precheck-status-"+t);if(r){n.html(n.html()+s)}else{n.html(s)}}function C(r){var s=t('<div class="error"><p><strong>'+r+"</strong></p></div>").hide().appendTo(t(".score-message")).slideDown(200).delay(200).fadeIn().delay(8e3).fadeTo(200,0).delay(1500).slideUp(200,function(){s.remove()});e.error(r)}function x(e){o.css("visibility",e?"visible":"hidden")}function y(){var e=t(this).data("dimensions");t(".device.desktop").width(e.w).height(e.h);t(".precheck-resize").find(".button").removeClass("active");t(this).addClass("active")}function j(){$();x(true);w("sending");d.prop("disabled",true);v=0;t(".precheck-status-icon").html("");e.util.ajax("send_test",{precheck:true,subscriber_id:t("#subscriber_id").val(),formdata:t("#post").serialize(),to:t("#mailster_testmail").val(),content:e.$.content.val(),head:e.$.head.val(),plaintext:e.$.excerpt.val()},function(e){if(e.success){c=e.id;setTimeout(function(){w("checking");T(1)},3e3)}else{C(e.msg);x(false);d.prop("disabled",false)}},function(e,t,r){x(false);d.prop("disabled",false)})}function $(){a.find("summary").removeAttr("class");a.find(".precheck-result").empty();w("ready")}function T(r){if(r>10){C(e.l10n.precheck.email_not_sent);x(false);d.prop("disabled",false);return}e.util.ajax("precheck",{id:c},function(s){if(s.success){if(!s.ready){setTimeout(function(){T(++r)},3e3)}else{w("collecting");t(".precheck-status-icon").html(e.util.sprintf("%s of 100",100));t.when.apply(t,[A("blocklist"),A("spam_report"),A("authentication"),A("message"),A("links","tests/links"),A("images","tests/images")]).done(function(e){w("finished");x(false);d.prop("disabled",false)})}}if(s.error){C(s.error);x(false);d.prop("disabled",false)}},function(e,t,r){x(false);d.prop("disabled",false)})}function A(e,r){var s=t("#precheck-"+e),i=s.find("details"),c,a=[];if(i.length){s.find("summary").eq(0).removeAttr("class").addClass("loading");for(var n=0;n<i.length;n++){c=i[n].id.replace("precheck-","");if(c){r="tests/"+c;a.push(q(c,r))}}}else{if(!r)r=e;a.push(q(e,r))}return t.when.apply(t,a).done(function(){var r,s={error:0,warning:0,notice:0,success:0};if(typeof arguments[1]!="string"){for(n in arguments){arguments[n]&&s[arguments[n][0].status]++}if(s.error){r="error"}else if(s.warning){r="warning"}else if(s.notice){r="notice"}else{r="success"}t("#precheck-"+e).find("summary").eq(0).removeClass("loading").addClass("loaded is-"+r)}})}function q(r,s){var i=t("#precheck-"+r),a=i.find("summary").eq(0).removeAttr("class").addClass("loading"),n=i.find(".precheck-result");return e.util.ajax("precheck_result",{id:c,endpoint:s},function(r){if(r.success){a.removeClass("loading").addClass("loaded is-"+r.status);if("error"==r.status){}t(".precheck-status-icon").html(e.util.sprintf("%s of 100",r.points));n.html(r.html)}if(r.error){C(r.error);x(false);d.prop("disabled",false)}},function(e,t,r){x(false);d.prop("disabled",false)})}function I(){t(".precheck-to").hide();t(".change-receiver").hide();t(".precheck-to-input").show().find("input").focus().select()}function z(){m=f.contents().find("html,body");g=m.find("highlighterx");k=m.find("highlightery");b=true;e.trigger("enable")}function B(r){if(!e.editor||!e.editor.loaded){e.events.push("editorLoaded",function(){B(r)});return}var s={id:e.campaign_id,subscriber_id:t("#subscriber_id").val(),content:e.editor.getContent(),head:e.$.head.val(),issue:t("#mailster_autoresponder_issue").val(),subject:e.details.$.subject.val(),preheader:e.details.$.preheader.val()},i=e.$.title.val();$();t(".precheck-status-icon").html("");e.util.ajax("set_preview",s,function(s){f.one("load",z).attr("src",ajaxurl+"?action=mailster_get_preview&hash="+s.hash+"&_wpnonce="+s.nonce);p.addClass("active");u.removeClass("active");tb_show(i?e.util.sprintf(e.l10n.campaigns.precheck,'"'+i+'"'):e.l10n.campaigns.preview,"#TB_inline?hash="+s.hash+"&_wpnonce="+s.nonce+"&width="+Math.min(1440,e.$.window.width()-50)+"&height="+(e.$.window.height()-100)+"&inlineId=mailster_precheck_wrap",null);t(".precheck-subject").html(s.subject);t(".precheck-subscriber").val(s.to);t(".precheck-to").text(s.to);r&&r()},function(t,r,s){e.trigger("enable")})}function L(){if(_){m.removeClass("precheck-structure-enabled")}else{m.addClass("precheck-structure-enabled")}u.toggleClass("active");_=!_}function D(){var e=m.find("img");if(!b){m.removeClass("precheck-images-hidden");t.each(e,function(e,r){t(r).attr("src",t(r).attr("data-src")).removeAttr("data-src")})}else{m.addClass("precheck-images-hidden");t.each(e,function(e,r){t(r).attr("data-src",t(r).attr("src")).attr("src","")})}p.toggleClass("active");b=!b}function M(e){var r=t(this),s=r.data(),i,c=e.type;if(!s.el){var a=s.url,n=s.tag,l=s.attr,o=s.index,i=f.contents().find(n+"["+l+'="'+a+'"]')[o];r.data("el",i)}else{i=s.el}if(!i){return}if("mouseleave"==c){m.removeClass("precheck-highlighter");t(i).removeClass("precheck-highlighted");return}else{t(i).addClass("precheck-highlighted");m.addClass("precheck-highlighter")}i.scrollIntoView({behavior:"smooth",block:"center"});var h=i.getBoundingClientRect();g.css({transform:"translate("+h.x+"px, "+(h.y+m.scrollTop())+"px)",width:h.width,height:h.height});k.css({transform:"translate("+h.x+"px, "+(h.y+m.scrollTop())+"px)",width:h.width,height:h.height})}function Q(){if(!t("#precheck-agree-checkbox").is(":checked")){alert(e.l10n.campaigns.agree_precheck_terms);return false}e.util.ajax("precheck_agree",function(t){a.addClass("precheck-terms-agreed");e.precheck.terms_accepted=true})}e.precheck.open=function(r){e.trigger("save");e.trigger("disable");t(".precheck-from").html(t("#mailster_from-name").val());B(r)};e.precheck.start=j;e.precheck.terms_accepted=!!t(".precheck-terms-agreed").length;return e}(mailster||{},jQuery,window,document);