mailster=function(t,a,e,i){"use strict";var s,r=a("#email"),o=a("#ID").val(),n=a(".avatar"),l=a("form#subscriber_form");a.easyPieChart&&a(".piechart").easyPieChart({animate:1e3,rotate:180,barColor:t.colors.main,trackColor:t.colors.track_light,lineWidth:9,size:75,lineCap:"butt",onStep:function(e){this.$el.find("span").text(Math.round(e))},onStop:function(e){this.$el.find("span").text(Math.round(e))}});a("#subscriber_form").on("submit",function(){clearTimeout(s);r.off("blur").off("keyup");a(this).submit(false)});a(".detail").on("click",function(){var e=a(this).addClass("active"),i=e.find(".click-to-edit"),t=i.find("> li").first(),s=i.find("> li").last();if(!t.is(":hidden")){t.hide();s.show().find("input").first().focus().select();s.show().find("textarea").first().focus().select()}});a("#mailster_status").on("change",function(){if(a(this).val()<=0){a(".pending-info").show()}else{a(".pending-info").hide()}});a(".show-more-info").on("click",function(){a(".more-info").slideToggle(100)});a(".map.zoomable").on("click",function(){var e=a(this),i=e.find("img");if(!i.hasClass("zoomed")){i.attr("src",i.attr("src").replace(/zoom=\d+/,"zoom=11")).addClass("zoomed")}else{i.attr("src",i.attr("src").replace(/zoom=\d+/,"zoom=5")).removeClass("zoomed")}});a.datepicker&&a("input.datepicker").datepicker({dateFormat:"yy-mm-dd",firstDay:t.l10n.subscribers.start_of_week,dayNames:t.l10n.subscribers.day_names,dayNamesMin:t.l10n.subscribers.day_names_min,monthNames:t.l10n.subscribers.month_names,prevText:t.l10n.subscribers.prev,nextText:t.l10n.subscribers.next,showAnim:"fadeIn",onClose:function(){var e=a(this).datepicker("getDate");a(".deliverydate").html(a(this).val())}});a.fn.select2&&a(".tags-input").select2({placeholder:t.l10n.subscribers.choose_tags,tags:true,theme:"mailster"});r.on("blur",function(){var e=a(this),i=t.util.trim(e.val());a(this).val(i);if(n.data("email")!=i){n.addClass("avatar-loading");c(i,function(e){if(e.success)n.data("email",i).removeClass("avatar-loading").css({"background-image":"url("+e.url.replace(/&amp;/,"&")+")"})})}if(!i)l.prop("disabled",true);e.trigger("keyup")}).on("keyup",function(){var i=a(this);clearTimeout(s);s=setTimeout(function(){var e=t.util.trim(i.val());t.util.ajax("check_email",{email:e,id:o},function(e){l.prop("disabled",e.exists);a(".email-error").slideUp(100,function(){a(this).remove()});if(e.exists){a('<p class="email-error">&#9650; '+t.l10n.subscribers.email_exists+"</p>").hide().insertAfter(i).slideDown(100);setTimeout(function(){i.focus(),1})}})},400);l.prop("disabled",true)});function c(e,i){t.util.ajax("get_gravatar",{email:e},i)}return t}(mailster||{},jQuery,window,document);